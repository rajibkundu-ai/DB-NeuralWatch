version: '3.8'
services:
  backend:
    build: ./backend
    environment:
      ADMIN_USERNAME: ${ADMIN_USERNAME:-admin}
      ADMIN_PASSWORD: ${ADMIN_PASSWORD:-supersecret}
      SECRET_KEY: ${SECRET_KEY:-change-me}
      SQLSERVER_CONNECTION_STRING: "${SQLSERVER_CONNECTION_STRING:-Driver={ODBC Driver 18 for SQL Server};Server=tcp:sqlserver,1433;Database=master;Uid=sa;Pwd=Strong!Pass;Encrypt=yes;}"
      METRICS_POLL_INTERVAL: ${METRICS_POLL_INTERVAL:-30}
      ALERT_CPU_THRESHOLD: ${ALERT_CPU_THRESHOLD:-85}
      ALERT_MEMORY_THRESHOLD: ${ALERT_MEMORY_THRESHOLD:-85}
      ALERT_DISK_IO_THRESHOLD: ${ALERT_DISK_IO_THRESHOLD:-80}
      RETENTION_HOURS: ${RETENTION_HOURS:-336}
    ports:
      - "8000:8000"
    volumes:
      - ./backend/data:/app/data
  frontend:
    build:
      context: ./frontend
      args:
        VITE_API_BASE_URL: ${VITE_API_BASE_URL:-http://backend:8000/api}
    ports:
      - "5173:80"
    depends_on:
      - backend
